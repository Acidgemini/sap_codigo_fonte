<h1 style="text-align: center;">Controle de Projetos</h1>

<!-- <pre>{{this.projetos | json }}</pre> -->
<p-panel [toggleable]="true">
  <p-header id="titleHeader">Filtros</p-header>
  
  <div id="filtros">
    <div class="dashboardFiltro">
      <label>Projeto: </label>
      <input [(ngModel)]="this.projetos" pInputText type="text">
    </div>

    <div class="dashboardFiltro">
      <label>Lider: </label>
      <input [(ngModel)]="filtroLider" pInputText type="text">
    </div>

    <div class="dashboardFiltro">
      <label>OS: </label>
      <input [(ngModel)]="filtroOs" pInputText type="text">
    </div>

    <div >
      <a (click)="preencherFiltros()" pButton label="Filtrar"></a>
    </div>

  </div>
<!-- 
  <div class="ui-g">
    <div class="ui-g-2 ui-md-4 ui-sm-6">
      <a (click)="preencherFiltros()" pButton label="Filtrar"></a>
    </div>
  </div> -->

</p-panel>

<p-fieldset (onBeforeToggle)="obterOsPorProjeto(projeto.id)" *ngFor="let projeto of projetos" [toggleable]="true"
  [collapsed]="true">

  <p-header>{{projeto.nome}}</p-header>
  <div>
    <p-panel>
      <ul>
        <li>Lider: <span>{{obterNomeLider(projeto.idLider)}}</span></li>
        <li>Testador: <span>{{obterNomeTestador(projeto.id)}}</span></li>
        <li>Revisor: <span>{{obterNomeRevisor(projeto.id)}}</span></li>
        <li>Gerente: <span>{{obterNomeGerente(projeto.id)}}</span></li>
      </ul>
    </p-panel>

  </div>


  <p-table #dt [value]="listaOsProjeto" [paginator]="true" [rows]="4" [response]="true" [columns]="colunas" dataKey="nome">

    <ng-template let-columns pTemplate="header">
      <tr>
        <th style="width: 3em"></th>
        <th [class.action]="coluna.header == 'Ações'" *ngFor="let coluna of columns" pResizableColumn>
          {{coluna.header}}
        </th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-ordemservico let-expanded="expanded" let-columns="columns">
      <tr>
        <td>
          <a href="#" [pRowToggler]="ordemservico">
            <i [ngClass]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></i>
          </a>
        </td>
        <td>{{ ordemservico.nome }}</td>
        <td>{{ obterNomeSituacao(ordemservico.idSituacao) }}</td>
        <td>{{ ordemservico.dataProximaEntrega}}</td>
        <td>{{ ordemservico.prazo }}</td>
        <td>{{ ordemservico.pontosFuncao}}</td>
        <td>{{ ordemservico.fabrica }}</td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage" let-columns>
      <tr>
        <td [attr.colspan]="columns.length">
          <div class="text-center">
            <h3>Nenhuma ordem de serviço cadastrada!</h3>
          </div>
        </td>
      </tr>
    </ng-template>

    <!-- SPRINT -->
    <ng-template pTemplate="rowexpansion" let-ordemservico let-columns="columns">
      <tr>
        <td [attr.colspan]="columns.length + 1">
          <div class="p-grid -fluid" style="font-size:16px;padding:5px 5px 20px 5px;">
            <p-table paginator="true" [rows]="10" [columns]="coluna" [value]="sprints" dataKey="nome">
              <ng-template pTemplate="header" let-subcolumns>
      <tr>
        <th [class.action]="coluna.header == 'Ações'" *ngFor="let coluna of colunaSprint" pResizableColumn>
          {{coluna.header}}
        </th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-sprints let-expanded="expanded">
      <tr *ngIf="sprints.idOrdemServico == ordemservico.id">
        <td>{{ sprints.nome }}</td>
        <td>{{ sprints.dataInicio }}</td>
        <td>{{ sprints.dataTermino }}</td>
        <td>{{ sprints.pontosFuncao }}</td>
        <td>{{ obterBoolean(sprints.impedimento)}}</td>
        <td>{{ obterBoolean(sprints.prazo) }}</td>
        <td>{{ obterNomeStatus(sprints.idStatus)}}</td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage" let-subcolumns>
      <tr>
        <td [attr.colspan]="columns.length">
          <div class="text-center">
            <h3>Nenhuma OS cadastrada!</h3>
          </div>
        </td>
      </tr>
    </ng-template>

  </p-table>
  </div>
  </td>
  </tr>
  </ng-template>

  </p-table>

</p-fieldset>

<!-- <ng-container *ngIf="listaOrdemServico$ | async as listaOrdemServico; else loading ">
  <p-fieldset *ngFor="let cliente of clientes" [legend]="cliente.descricao" [toggleable]="true">
    <p-table [paginator]="true" [rows]="5" [responsive]="true" [rowsPerPageOptions]="[2, 4, 8, 10]" [columns]="colunas"
      [value]="listaOrdemServico">
      <ng-template let-columns pTemplate="header">
        <tr>
          <th [class.action]="coluna.header == 'Ações'" *ngFor="let coluna of columns">
            {{ coluna.header }}
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-ordemservico>
        <tr *ngIf="cliente.id == obterCliente(ordemservico.idProjeto)">
          <td>{{ ordemservico.nome }}</td>
          <td>{{ obterNomeSituacao(ordemservico.idSituacao)}}</td>
          <td>{{ ordemservico.pontosFuncao }}</td>
          <td>{{ ordemservico.dataProximaEntrega | date:'dd/MM/yyyy'  }}</td>
          <td>{{ obterSituacaoSprint(ordemservico.id) }}</td>
          <td>{{ ordemservico.qtdDefeitosInterno || 0 }}</td>
          <td>{{ ordemservico.qtdDefeitosCliente || 0}}</td>
          <td>{{ obterImpedimentoSprint(ordemservico.id) }}</td>
          <td>{{ obterNomeRevisor(ordemservico.idProjeto) }}</td>
          <td>{{ obterNomeGerente(ordemservico.idProjeto) }}</td>
          <td>{{ obterNomeTestador(ordemservico.idProjeto) }}</td>
          <td class="action-buttons">
            <button [routerLink]="[ordemservico.id]" pButton icon="ui-icon-mode-edit"></button>
            <button pButton icon="pi pi-times" (click)="deletar(ordemservico.id)"></button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage" let-columns>
        <tr>
          <td [attr.colspan]="columns.length">
            <div class="text-center">
              <h3>Nenhum Registro cadastrado!</h3>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-fieldset>
</ng-container> -->